<!DOCTYPE html>
<html>
<head>
    <meta charset="UTF-8"> 
    <title>设置头像</title>
</head>
<body>
    <?php view('common.nav')?>

    <h1>上传头像</h1>

    <form action="/user/setavatar" method="post" enctype="multipart/form-data">
        <?=csrf_field() ?>
        <input type="file" name="avatar" id="img">
        <input type="submit" value="上传头像">

    </form>



    <?php view('common.footer')?>
</body>
</html>
<script src="https://code.jquery.com/jquery-1.12.4.min.js"></script>
<script>
    var img = document.getElementById("img");
    img.onchange = function(){
        var img1 = this.files[0];  //获取一张图片
        var filesize = img1.size;  //图片尺寸
        var persize = 4096;  //4k
        var count = Math.ceil(filesize / persize); //上传的块数
        var name = "img_"+Math.random(1,99999);
        
        for(var i =0;i<count;i++){
            var img0 = img1.slice(i*persize,i*persize*persize);

            //加入表单中的
            var f = new FormData;
            f.append("img",img0);  //图片数据
            f.append("count",count);    //图片块数
            f.append("i",i);    //当前图片是第几块
            f.append('size',persize);
            f.append('img_name',name);

            $.ajax({
                type:"POST",
                url:"/user/mergeimg",
                data:f,
                contentType: false,
                processData: false,
                success:function(data){

                }
            })
        }

    }
</script>